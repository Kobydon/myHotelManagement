<div class="container" *blockUI="'loading'">
  <div class="card shadow-sm">
    <div class="card-body p-4">

      <h4 class="text-center mb-4">Income and Expenditure Report</h4>

      <!-- FORM -->
      <form [formGroup]="createForm" class="mb-4">

        <!-- START DATE -->
        <div class="form-group">
          <label>Start Date</label>
          <input
            type="date"
            class="form-control"
            formControlName="dates"
          />
        </div>

        <!-- END DATE -->
        <div class="form-group">
          <label>End Date</label>
          <input
            type="date"
            class="form-control"
            formControlName="datestwo"
            (change)="searchDates()"
          />
        </div>

        <!-- DATE ERROR -->
        <div
          class="alert alert-danger mt-2"
          *ngIf="
            createForm.errors?.sameDate &&
            createForm.get('datestwo')?.touched
          "
        >
          Start date and End date must be different days.
        </div>

        <!-- CASHIER -->
        <div class="form-group mt-3">
          <label>Filter By Cashier</label>
          <select
            class="form-control"
            formControlName="cashier"
            (change)="findCashier()"
          >
            <option value="">-- Select Cashier --</option>
            <option
              *ngFor="let item of cashiers"
              [value]="item.firstname + ' ' + item.lastname"
            >
              {{ item.firstname }} {{ item.lastname }}
            </option>
          </select>
        </div>

        <!-- PAYMENT METHOD -->
        <div class="form-group mt-3">
          <label>Filter By Method</label>
          <select
            class="form-control"
            formControlName="paymethod"
            (change)="findMethod()"
          >
            <option value="">-- Select Method --</option>
            <option value="Cash">Cash</option>
            <option value="Mobile Money">Mobile Money</option>
            <option value="Mobile Money & Cash">MoMo & Cash</option>
            <option value="Credit Card">Credit Card</option>
          </select>
        </div>

        <!-- DEPARTMENT -->
        <div class="form-group mt-3">
          <label>Filter By Department</label>
          <select
            class="form-control"
            formControlName="barrest"
            (change)="findDepartment()"
          >
            <option value="">-- Select Department --</option>
            <option value="drink">Bar</option>
            <option value="food">Restaurant</option>
          </select>
        </div>

        <!-- CATEGORY -->
        <div class="form-group mt-3">
          <label>Filter By Category</label>
          <select
            class="form-control"
            formControlName="categos"
            (change)="findCategory()"
          >
            <option value="">-- Select Category --</option>
            <option
              *ngFor="let item of categoryList"
              [value]="item.name"
            >
              {{ item.name }}
            </option>
          </select>
        </div>
      </form>

      <!-- ACTION BUTTONS -->
      <div class="mb-4">
        <button class="btn btn-primary mr-2" (click)="printToPdf()">Print</button>
        <button class="btn btn-secondary mr-2" (click)="downloadPdf()">Download PDF</button>
        <button class="btn btn-success mr-2" (click)="filterByMostPayment()">Most Payment</button>
        <button class="btn btn-info" (click)="filterByMostPaymentCustomer()">Top Customers</button>
      </div>

      <!-- REPORT -->
      <div *ngIf="incomeReport?.length || expenditureReport?.length; else noData" id="pdf">

        <p class="text-center">
          {{ createForm.value.dates | date:'longDate' }}
          to
          {{ createForm.value.datestwo | date:'longDate' }}
        </p>

        <!-- INCOME TABLE -->
        <h5>Income</h5>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Category</th>
              <th>Amount</th>
              <th>Customer</th>
              <th>Cashier</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of incomeReport">
              <td>{{ item.name }}</td>
              <td>{{ item.amount | currency:'₵' }}</td>
              <td>{{ item.customer }}</td>
              <td>{{ item.cashier }}</td>
            </tr>
          </tbody>
        </table>

        <!-- EXPENDITURE -->
        <h5>Expenditure</h5>
        <table class="table table-bordered">
          <tr *ngFor="let item of expenditureReport">
            <td>{{ item.name }}</td>
            <td>{{ item.amount | currency:'₵' }}</td>
          </tr>
        </table>

        <h5>Cash at Hand: {{ totalIncome - totalExpenditure | currency:'₵' }}</h5>

      </div>

      <ng-template #noData>
        <div class="alert alert-info text-center">
          No records found for selected date range.
        </div>
      </ng-template>

    </div>
  </div>
</div>
